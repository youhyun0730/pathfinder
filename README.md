# スキルツリーRPG - アイデア提案書

## コンセプト
人生を可視化されたスキルグラフで捉え、ゲーム感覚で成長を楽しむWebアプリケーション

---

## システムアーキテクチャ概要

### データ構造の設計思想

**中心ノード（ユーザー）を起点とした放射状グラフ構造**
- 各「現在地ノード」が異なる方向に配置
- スキルツリーは木構造だが、複数の木が中心から生えるイメージ
- ノード間は親子関係（前提条件）で接続

### ノードタイプの定義

1. **中心ノード**: ユーザー本人（固定、削除不可）
2. **現在地ノード**: LLMが分類した現在のポジション（例: Jr.エンジニア、初心者シェフ）
3. **スキルノード**: 技術、能力（例: JavaScript、コミュニケーション力）
4. **資格ノード**: 取得可能な資格（例: 基本情報技術者、調理師免許）
5. **ポジションノード**: 到達できる職業・役職（例: シニアエンジニア、レストランオーナー）

---

## フェーズ1: ユーザーオンボーディング

### アキネイター式質問フロー

**質問テンプレート設計:**
- 5-10問程度の分岐質問
- カテゴリ: 仕事、趣味、学歴、取得資格、得意分野、興味分野
- 回答形式: 選択式、自由記述、スライダー（熟練度）

**質問例:**
1. 「現在の職業は？」→ 選択肢 or 自由記述
2. 「プログラミング経験は？」→ なし/独学/実務経験あり
3. 「最も時間を使っている趣味は？」
4. 「5年後、どんな自分になりたい？」

**データ保存形式:**
```
userProfile: {
  answers: [...],
  interests: [...],
  currentSkills: [...],
  aspirations: [...]
}
```

### LLMによる現在地分類

**Prompt設計のポイント:**
- ユーザーの回答を構造化してLLMに渡す
- 「このユーザーを複数の軸で分類し、それぞれの軸での現在地を定義してください」
- 出力フォーマットを厳密に指定（JSON形式）

**期待する出力:**
```
[
  {
    category: "テクノロジー",
    currentPosition: "JavaScript Jr.エンジニア",
    reasoning: "実務経験1年、React学習中"
  },
  {
    category: "クリエイティブ",
    currentPosition: "趣味カメラマン",
    reasoning: "5年の撮影経験、SNSで作品公開"
  }
]
```

---

## フェーズ2: スキルツリー生成

### 初期ツリー生成ロジック

**各現在地ノードに対して:**
1. LLMに「このポジションから成長できる3-5段階の分岐ツリー」を生成させる
2. 各ノードに以下の属性を付与:
   - nodeType: skill/certification/position
   - requiredExp: 難易度ベースで算出（50-1000の範囲）
   - prerequisites: 親ノードのIDリスト
   - description: このノードの説明（LLM生成）
   - suggestedResources: 学習リソースのヒント

**難易度→EXP変換ルール:**
- 初級スキル: 50-100 EXP
- 中級スキル: 100-300 EXP
- 上級スキル: 300-500 EXP
- 資格: 200-800 EXP（難易度による）
- ポジション: 500-1000 EXP

### ツリー拡張機能

**ユーザー主導の拡張:**
- 任意のノードを選択 → 「ここから先を提案」
- LLMに「このスキル/ポジションの次のステップを3-5個提案」
- 提案をユーザーが選択 → ツリーに追加

**Prompt例:**
「ユーザーは現在『React中級者』のスキルを持っています。次に習得すべきスキル、取得できる資格、到達できるポジションを3-5個提案してください」

---

## フェーズ3: インタラクション設計

### タップによる進捗システム

**タップ挙動:**
- 1タップ = +10 EXP（仮）
- 親ノードが100%でない場合、子ノードはタップ不可（グレーアウト）
- 連続タップでアニメーション効果

**進捗の可視化:**
- ノードの縁を光の輪で囲む（0-100%に応じて円周を描画）
- 色の変化: 0% 灰色 → 50% 黄色 → 100% 金色
- 100%達成時に派手なアニメーション（パーティクル効果）

### 長押しメニュー

**表示項目:**
1. 「詳細を見る」→ description、suggestedResources表示
2. 「ツリーを伸ばす」→ LLMに次のステップを提案させる
3. 「進捗をリセット」→ 現在のEXPを0に戻す
4. 「このノードを削除」→ 確認ダイアログ → 子ノード全て削除

**削除時の警告:**
「このノードを削除すると、以下の○個のノードも失われます。本当に削除しますか？」

---

## フェーズ4: 目標入力機能

### 目標からの逆算ツリー生成

**フロー:**
1. ユーザーが目標を自由記述（例: 「フルスタックエンジニアになる」）
2. LLMに現在のスキルツリー全体を渡す
3. 「現在のノードから、この目標に到達するための最適パスを提案」
4. 既存ツリーに新しいノードを追加、または既存ノードを強調

**Prompt設計:**
- 現在のツリー構造（JSON）をcontextとして渡す
- 「既存のノードをできるだけ活用し、足りないノードだけ追加」を指示
- 目標ノードまでのパス（recommended path）も生成

**視覚的表現:**
- 目標ノードをハイライト（特別な色・アイコン）
- 推奨パスのエッジを太線または点滅表示
- 「あと○ノード」のカウンター表示

---

## UI/UX設計のポイント

### グラフレイアウトアルゴリズム

**推奨ライブラリ: React Flow または Cytoscape.js**
- Force-directed layout（力学モデル）で自動配置
- 中心ノードから放射状に現在地ノードを配置
- 各サブツリーは階層的に展開

**レイアウトのルール:**
- 中心ノード: 画面中央固定
- 現在地ノード: 中心から等間隔の円周上に配置
- スキルツリー: 親→子で外側に向かって展開
- ズーム・パン機能必須

### カラースキーム

**ノードタイプ別の色:**
- 中心ノード: ゴールド（#FFD700）
- 現在地ノード: ブルー（#4A90E2）
- スキルノード: グリーン（#7ED321）
- 資格ノード: パープル（#9013FE）
- ポジションノード: オレンジ（#F5A623）
- 目標ノード: レッド（#D0021B）

**進捗状態の表現:**
- 未着手: 灰色の薄い輪郭
- 進行中: 該当色 + 光る円周（進捗率に応じて）
- 完了: 該当色 + 金色の輝き

### アニメーション

**重要な体験:**
- ノード完了時: 爆発エフェクト + 効果音
- ツリー拡張時: 新しいノードがフェードイン
- タップ時: リップルエフェクト
- 削除時: フェードアウト

---

## データ永続化戦略

### 認証の段階的アプローチ

**MVP（100人テスト）:**
- メールアドレス + パスワードレス認証（マジックリンク）
- Supabase Authを活用
- シンプルなログインフローで離脱を防ぐ

**本格化後:**
- Google/GitHub OAuth追加
- ゲストモード（ローカルストレージ、後で移行可能）

### JSON構造設計

```
{
  userId: string,
  profile: {
    answers: [...],
    createdAt: timestamp
  },
  graph: {
    nodes: [
      {
        id: string,
        type: "center|current|skill|cert|position",
        label: string,
        description: string,
        requiredExp: number,
        currentExp: number,
        parentIds: string[],
        position: {x, y}, // レイアウト保存
        color: string,
        isGoal: boolean
      }
    ],
    edges: [
      {from: string, to: string}
    ]
  },
  goals: [
    {
      id: string,
      description: string,
      targetNodeId: string,
      createdAt: timestamp
    }
  ],
  metadata: {
    lastModified: timestamp,
    version: number
  }
}
```

---

## LLM活用の最適化

### Prompt工学のポイント

**コンテキストの効率的な管理:**
- 初回生成時: フルプロファイルを渡す
- ツリー拡張時: 関連ノードのみを抽出して渡す
- 目標設定時: 既存ツリー全体を渡すが、要約形式で

**出力フォーマットの厳密化:**
- JSON Schemaを明示
- Few-shot examplesを含める
- 「必ず以下の形式で出力してください」を徹底

**コスト最適化:**
- キャッシュ可能な部分（テンプレート）を分離
- ユーザー入力が小さい場合は小型モデル使用
- バッチ処理で複数ノード生成を1回のAPI呼び出しに

---

## 差別化ポイント

### 既存サービスとの違い

**vs スキルマトリクス/ロードマップツール:**
- 静的な表ではなく、動的に成長するグラフ
- ゲーム要素（タップ、レベルアップ）で習慣化

**vs 学習プラットフォーム:**
- コンテンツ提供ではなく、自分のペースでの進捗管理
- LLMによる個別最適化された提案

**vs ToDoアプリ:**
- タスクではなく「自分の成長」を可視化
- 長期的なキャリアビジョンとの接続

### ユーザー体験の核心

**「自分の可能性が見える」感覚:**
- どこまで成長できるかが視覚的に理解できる
- 意外な繋がり（料理スキル→プロジェクト管理）の発見

**「積み上げる喜び」:**
- タップするたびに確実に前進する実感
- ノードが光り輝く瞬間の達成感

**「迷わない」安心感:**
- 次に何をすべきかLLMが示してくれる
- でも強制ではなく、自分で選べる自由

---

## 技術的な懸念事項と対策

### パフォーマンス

**問題:** ノード数が増えると描画が重くなる
**対策:** 
- 仮想化（見えている範囲だけレンダリング）
- ノード数上限を設定（例: 100個まで）
- 古いノードのアーカイブ機能

### LLMコスト

**問題:** ユーザー増加でAPI費用が高騰
**対策:**
- キャッシュ戦略（類似リクエストの再利用）
- ユーザーあたりの月間API呼び出し制限
- 有料プランでの収益化

### データ整合性

**問題:** ノード削除時の整合性、親子関係の破綻
**対策:**
- 削除時に子孫ノードを再帰的にチェック
- トランザクション的な更新処理
- バージョン管理（undo機能）

---

## 開発優先順位（MVP）

### Phase 1
1. 基本的なグラフ描画（React Flow導入）
2. ノードの追加・削除・表示
3. Supabase連携（認証 + データ保存）

### Phase 2
4. オンボーディングフロー
5. LLM統合（現在地分類 + ツリー生成）
6. タップによる進捗機能

### Phase 3
7. 長押しメニュー
8. ツリー拡張機能
9. UI/UXの磨き込み

### Phase 4
10. 目標入力機能
11. バグ修正、パフォーマンス最適化
12. テストユーザー向けオンボーディング資料


---

このアイデアの核心は**「人生をゲーム化する」ことで、成長を楽しく継続できるようにする**ことです。LLMはあくまでパーソナライゼーションのツールであり、主役はユーザー自身の成長体験です。
# トラブルシューティング

## ログインできない問題

### 症状
- アカウント登録は成功するがログインできない
- 「メールアドレスまたはパスワードが正しくありません」というエラーが出る

### 原因
Supabaseはデフォルトでメール確認を要求します。メール確認が完了していないとログインできません。

### 解決方法

#### 方法1: メール確認を完了する（本番推奨）

1. サインアップ後、登録したメールアドレスに確認メールが届きます
2. メール内の「Confirm your mail」リンクをクリック
3. 確認が完了したらログインページに戻ってログイン

#### 方法2: 開発環境でメール確認を無効にする（開発のみ）

Supabase Dashboardで以下の設定を変更：

1. Supabase Dashboard → Authentication → Settings へ移動
2. 「Email Auth」セクションを開く
3. **「Confirm email」をオフ**にする
4. 「Save」をクリック

これで新規登録時にメール確認なしですぐにログインできるようになります。

**⚠️ 注意**: 本番環境では必ずメール確認を有効にしてください。

#### 方法3: Supabase Dashboardから直接ユーザーを確認済みにする

1. Supabase Dashboard → Authentication → Users へ移動
2. 該当ユーザーを見つけて「⋮」メニューをクリック
3. 「Confirm User」を選択

これで既存ユーザーを手動で確認済みにできます。

---

## その他の認証問題

### RLSポリシーエラー

**症状**: ログインは成功するが、データベースにアクセスできない

**解決方法**:
1. Supabase Dashboard → SQL Editor を開く
2. `supabase/migrations/20250104000000_initial_schema.sql` の内容を実行
3. RLSポリシーが正しく設定されているか確認

### セッション切れ

**症状**: ログイン後すぐにログアウトされる

**解決方法**:
1. ブラウザのCookieが有効になっているか確認
2. `.env.local` の設定が正しいか確認
3. Supabaseプロジェクトの URL と ANON_KEY が正しいか確認

---

## デバッグ方法

### ブラウザのコンソールを確認

1. ブラウザの開発者ツールを開く（F12 または Cmd+Option+I）
2. Console タブを開く
3. ログイン時のメッセージを確認：
   - 「ログイン成功」が表示されるか
   - 「プロファイル」情報が表示されるか
   - エラーメッセージの詳細を確認

### ログを追加する

`app/login/page.tsx` にはデバッグ用の `console.log` が含まれています：
- ログイン成功メッセージ
- プロファイル取得状況
- リダイレクト先の情報

これらをブラウザコンソールで確認してください。

---

## よくある質問

### Q: メール確認メールが届かない

**A**: 以下を確認してください：
- 迷惑メールフォルダを確認
- Supabase Dashboard → Authentication → Email Templates で送信元を確認
- 開発環境では方法2（メール確認を無効化）を使用

### Q: パスワードを忘れた

**A**:
1. ログインページで「パスワードを忘れた」機能を追加予定
2. または Supabase Dashboard → Authentication → Users から該当ユーザーを削除して再登録

### Q: オンボーディングをやり直したい

**A**:
1. Supabase Dashboard → Table Editor → profiles でプロファイルを削除
2. graphs, nodes, edges テーブルから該当データも削除
3. 再度ログインするとオンボーディングに進みます
